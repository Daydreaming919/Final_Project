---
title: "Final_Project"
author: "Hao Xu"
format: html
---
```{r}
library(here)
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
here::i_am("Final_Project.Rproj")
```

The data of Pisa are available only in SAV format, in order to use the data, we need install some libraries so that we can treat with SAV files. The data from 2000-2012 are got
through SPSS.
```{r}
library(haven)
library(tidyverse)
```

```{r}
pisa2022 <- read_sav(here("Data", "Pisa_Raw", "Student2022.SAV"))
```

```{r}
pisa2022_clean <- pisa2022 %>%
  mutate(year = 2022) %>%
  
  mutate(
    computer_n = as.numeric(ST254Q02JA) + as.numeric(ST254Q03JA),
    gender = as_factor(ST004D01T)
  ) %>%
  select(
    year,                       
    country = CNT,              
    school_id = CNTSCHID,       
    student_id = CNTSTUID,    
    
    mother_educ = ST005Q01JA,   
    father_educ = ST007Q01JA,   
    gender,                     
    
    room = ST250Q01JA,          
    computer = ST250Q02JA,      
    internet = ST250Q05JA,      
    
    car = ST251Q01JA,           
    television = ST254Q01JA,    
    computer_n,               
    book = ST255Q01JA,          
    
    math = PV1MATH,             
    read = PV1READ,             
    science = PV1SCIE,          
    stu_wgt = W_FSTUWT,         
    
    wealth = HOMEPOS,            
    escs = ESCS               
  ) %>%
  

  zap_labels()

output_dir <- here("Data", "Pisa_clean")

write_rds(pisa2022_clean, file.path(output_dir, "pisa2022_clean.rds"))
```



```{r}
pisa2018 <- read_sav(here("Data", "Pisa_Raw", "Student2018.sav"))
```

```{r}
pisa2018_clean <- pisa2018 %>%
  
  mutate(year = 2018) %>%
  mutate(
    computer_n = as.numeric(ST012Q06NA),
    
    gender = as_factor(ST004D01T)
  ) %>%

  select(
    year,
    country = CNT,
    school_id = CNTSCHID,
    student_id = CNTSTUID,
    
    mother_educ = MISCED,       
    father_educ = FISCED,       
    gender,
    
    room = ST011Q02TA,          
    computer = ST011Q04TA,      
    internet = ST011Q06TA,      
    desk = ST011Q01TA,  
    
    car = ST012Q02TA,           
    television = ST012Q01TA,    
    computer_n,                 
    
    book = ST013Q01TA,          
    
    math = PV1MATH,
    read = PV1READ,
    science = PV1SCIE,
    stu_wgt = W_FSTUWT,
    
    wealth = HOMEPOS,           
    escs = ESCS
  ) %>%
  
  zap_labels()

output_dir <- here("Data", "Pisa_clean")

write_rds(pisa2018_clean, file.path(output_dir, "pisa2018_clean.rds"))
```

```{r}
pisa2015 <- read_sav(here("Data", "Pisa_Raw", "Student2015.sav"))
```

```{r}
pisa2015_clean <- pisa2015 %>%
  
  mutate(year = 2015) %>%
  mutate(
    computer_n = as.numeric(ST012Q06NA),,
    
    gender = as_factor(ST004D01T)
  ) %>%

  select(
    year,
    country = CNT,
    school_id = CNTSCHID,
    student_id = CNTSTUID,
    
    mother_educ = MISCED,       
    father_educ = FISCED,       
    gender,

    room = ST011Q02TA,          
    computer = ST011Q04TA,      
    internet = ST011Q06TA,      
    desk = ST011Q01TA,   
    
    car = ST012Q02TA,           
    television = ST012Q01TA,    
    computer_n,                 
    
    book = ST013Q01TA,          
    
    math = PV1MATH,
    read = PV1READ,
    science = PV1SCIE,
    stu_wgt = W_FSTUWT,
    
    wealth = HOMEPOS,           
    escs = ESCS
  ) %>%
  
  zap_labels()

output_dir <- here("Data", "Pisa_clean")

write_rds(pisa2015_clean, file.path(output_dir, "pisa2015_clean.rds"))
```

